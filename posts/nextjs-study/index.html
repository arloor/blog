<!DOCTYPE html>
<html lang="zh-CN">

    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    
    <link rel="canonical" href="https://www.arloor.com/posts/nextjs-study/">
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.157.0">

    
    
    

<title>NextJS Study • ARLOOR</title>
<meta name="description" content="今天，你学习了吗">
<meta name="keywords" content="刘港欢, arloor, moontell">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="NextJS Study">
  <meta name="twitter:description" content="是时候学习下现代的前端开发，之前学过html、css和js的dom操作，这次来系统学习下react、nextjs等前端技术栈。">
      <meta name="twitter:site" content="@njulgh">

<meta property="og:url" content="https://www.arloor.com/posts/nextjs-study/">
  <meta property="og:site_name" content="ARLOOR">
  <meta property="og:title" content="NextJS Study">
  <meta property="og:description" content="是时候学习下现代的前端开发，之前学过html、css和js的dom操作，这次来系统学习下react、nextjs等前端技术栈。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-07T16:42:51+08:00">
    <meta property="article:modified_time" content="2024-11-07T16:42:51+08:00">
    <meta property="article:tag" content="Undefined">


    





<link rel="stylesheet" href="/styles/atom-one-dark.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.debf1b963c1830f6b9b96ee48c2b4a22c31c7c3885a87bed290c0e198fc6a08d.css" integrity="sha256-3r8bljwYMPa5uW7kjCtKIsMcfDiFqHvtKQwOGY/GoI0=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">




<link rel="stylesheet" href="/scss/hugo-toc.6b7222b4ddd3cebd47d144a2e37ade6cbbb64f47e31d8feac655896156ade206.css" integrity="sha256-a3IitN3Tzr1H0USi43rebLu2T0fjHY/qxlWJYVat4gY=">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>



<body class="  ">
  
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="/">
          
          ARLOOR
          
        </a>
      </span>
      <a href="/">
        
        
        <div class="author-image">
          <img src="/img/head.jpeg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
        
      </a>
      
      <p class="site__description">
         都是瞎写的 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">ARLOOR</label>
      <div class="menu-content menu-content--mobile">
        <div class="show-in-small">
          <a href="/">
            
            
            <div class="author-image">
              <img src="/img/head.jpeg" alt="Author Image"
                class="img--circle img--headshot element--center">
            </div>
            
            
          </a>
        </div>
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>文章</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/">
						<span>分类</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>关于我</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/grafana-iframe">
						<span>Grafana</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/net-iframe">
						<span>网速监控</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/nat">
						<span>NAT规则</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/stock">
						<span>股票监控</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://x.com/njulgh" rel="me" target="_blank"><i class="fa-brands fa-x-twitter fa-lg"></i></a>
	
	
	
	
	
	<a href="https://github.com/arloor" rel="me" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<a href="https://t.me/never_contact_me" rel="me" target="_blank"><i class="fa-brands fa-telegram fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="mailto:admin@arloor.com" rel="me" target="_blank"><i class="fa-solid fa-at fa-lg"></i></a>
	
	
	
	
</section>
      </div>
    </div>
    <div class="menu-content menu-content--desktop">
      <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>文章</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/">
						<span>分类</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>关于我</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/grafana-iframe">
						<span>Grafana</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/net-iframe">
						<span>网速监控</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/nat">
						<span>NAT规则</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/stock">
						<span>股票监控</span>
					</a>
				</li>
			 
		
	</ul>
</div>

    </div>
    <div class="social-wrap social-wrap--desktop">
      <section class="social">
	
	<a href="https://x.com/njulgh" rel="me" target="_blank"><i class="fa-brands fa-x-twitter fa-lg"></i></a>
	
	
	
	
	
	<a href="https://github.com/arloor" rel="me" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<a href="https://t.me/never_contact_me" rel="me" target="_blank"><i class="fa-brands fa-telegram fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="mailto:admin@arloor.com" rel="me" target="_blank"><i class="fa-solid fa-at fa-lg"></i></a>
	
	
	
	
</section>
    </div>
    
<div class="copyright">
  &copy; 2026 arloor
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/arloor/hyde-arloor">hyde-arloor</a>.
</div>


  </div>
</div>

  <div class="content container">
    
    
<article>
  <header>
    <h1>NextJS Study</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Nov 7, 2024
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/undefined">UNDEFINED</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/undefined">undefined</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 13 min read
</div>


  </header>
  
  
  
    <div class="toc-wrapper">
      <input type="checkbox" id="tocToggle">
      <label for="tocToggle">Table of Content</label>
      
          <nav id="TableOfContents">
  <ul>
    <li><a href="#前置准备">前置准备</a>
      <ul>
        <li><a href="#安装nodejs">安装nodejs</a></li>
      </ul>
    </li>
    <li><a href="#创建example项目">创建example项目</a></li>
    <li><a href="#prettier">prettier</a></li>
    <li><a href="#eslintconfigmjs-配置">eslint.config.mjs 配置</a></li>
    <li><a href="#简单的ts">简单的TS</a></li>
    <li><a href="#样式">样式</a>
      <ul>
        <li><a href="#全局样式">全局样式</a></li>
        <li><a href="#css-modules">CSS Modules</a></li>
        <li><a href="#使用-clsx-库切换类名">使用 <code>clsx</code> 库切换类名</a></li>
      </ul>
    </li>
    <li><a href="#优化字体和图像">优化字体和图像</a>
      <ul>
        <li><a href="#添加字体">添加字体</a></li>
        <li><a href="#添加图像">添加图像</a></li>
      </ul>
    </li>
    <li><a href="#布局和页面">布局和页面</a>
      <ul>
        <li><a href="#创建页面">创建页面</a></li>
        <li><a href="#创建布局">创建布局</a></li>
      </ul>
    </li>
    <li><a href="#优化导航">优化导航</a></li>
    <li><a href="#使用服务器组件server-components获取数据">使用服务器组件(Server Components)获取数据</a></li>
    <li><a href="#静态渲染和动态渲染">静态渲染和动态渲染</a>
      <ul>
        <li><a href="#什么是静态渲染">什么是静态渲染？</a></li>
        <li><a href="#什么是动态渲染">什么是动态渲染？</a></li>
      </ul>
    </li>
    <li><a href="#streaming-渐进式渲染">Streaming 渐进式渲染</a>
      <ul>
        <li><a href="#使用-loadingtsx-文件">使用 loading.tsx 文件</a></li>
        <li><a href="#流式传输动态组件">流式传输动态组件</a></li>
      </ul>
    </li>
    <li><a href="#部分预渲染partial-prerendering-ppr和增量静态生成incremental-static-regeneration-isr">部分预渲染Partial Prerendering (PPR)和增量静态生成Incremental Static Regeneration (ISR)</a>
      <ul>
        <li><a href="#部分预渲染如何工作">部分预渲染如何工作？</a></li>
        <li><a href="#启用部分预渲染">启用部分预渲染</a></li>
      </ul>
    </li>
    <li><a href="#使用客户端组件添加搜索和分页并通过客户端重定向修改url并保持input的输入和input关联以及输入的防抖">使用客户端组件添加搜索和分页，并通过客户端重定向修改url，并保持input的输入和input关联，以及输入的防抖</a></li>
    <li><a href="#route-handlers">Route Handlers</a></li>
    <li><a href="#其他文档">其他文档</a></li>
  </ul>
</nav>
      
    </div>
  
  
  <div class="post">
    <p>是时候学习下现代的前端开发，之前学过html、css和js的dom操作，这次来系统学习下react、nextjs等前端技术栈。</p>
<h2 id="前置准备">前置准备</h2>
<h3 id="安装nodejs">安装nodejs</h3>
<p>Debian12:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -Lf https://nodejs.org/dist/v20.18.0/node-v20.18.0-linux-x64.tar.xz -o /tmp/node-v20.18.0-linux-x64.tar.xz
</span></span><span style="display:flex;"><span>apt-get install xz-utils -y
</span></span><span style="display:flex;"><span>tar -xvf /tmp/node-v20.18.0-linux-x64.tar.xz -C /usr/local
</span></span><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span>$PATH:/usr/local/node-v20.18.0-linux-x64/bin
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;export PATH=$PATH:/usr/local/node-v20.18.0-linux-x64/bin&#39;</span> &gt;&gt; /etc/profile
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;export PATH=$PATH:/usr/local/node-v20.18.0-linux-x64/bin&#39;</span> &gt;&gt; /etc/zshenv
</span></span><span style="display:flex;"><span>node -v<span style="color:#f92672">&amp;&amp;</span>npm -v
</span></span></code></pre></div><p>macOS:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install node npm
</span></span><span style="display:flex;"><span>node -v<span style="color:#f92672">&amp;&amp;</span>npm -v
</span></span></code></pre></div><h2 id="创建example项目">创建example项目</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install -g pnpm
</span></span><span style="display:flex;"><span>yes| npx create-next-app@latest nextjs-dashboard-demo --use-pnpm --example <span style="color:#e6db74">&#34;https://github.com/vercel/next-learn/tree/main/dashboard/starter-example&#34;</span>
</span></span><span style="display:flex;"><span>cd nextjs-dashboard-demo
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;s/next dev --turbopack/next dev --turbopack -H 127.0.0.1 -p 3000/g&#39;</span> package.json <span style="color:#75715e"># 修改启动的host</span>
</span></span><span style="display:flex;"><span>cd nextjs-dashboard-demo
</span></span><span style="display:flex;"><span>pnpm i <span style="color:#75715e">#安装依赖</span>
</span></span><span style="display:flex;"><span>pnpm dev <span style="color:#75715e">#启动项目</span>
</span></span></code></pre></div><p><code>/app</code>: 包含所有的路由、组件、逻辑，是主要代码的所在。
<code>/app/lib</code>: 包含应用使用的函数，例如可复用的utils函数和数据获取函数。
<code>/app/ui</code>: 包含所有的UI组件，例如卡片、表格、表单。
<code>/public</code>: 包含所有的静态资源，例如图片
<strong>Config Files</strong>: 在根目录还有 <code>next.config.js</code> 等配置文件。如果你使用 <code>create-next-app</code> 初始化项目，那么大部分文件已经预先配置好了。在NextJS的官方example中，不需要修改这个文件。</p>
<h2 id="prettier">prettier</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install -g prettier
</span></span></code></pre></div><p>vscode安装插件：<a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">esbenp.prettier-vscode</a></p>
<p>settings.json</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;editor.formatOnSave&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;editor.defaultFormatter&#34;</span>: <span style="color:#e6db74">&#34;esbenp.prettier-vscode&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;eslint.format.enable&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;files.exclude&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;**/.next&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;**/node_modules&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;[typescriptreact]&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;editor.defaultFormatter&#34;</span>: <span style="color:#e6db74">&#34;esbenp.prettier-vscode&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>.prettierrc</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;semi&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;singleQuote&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;trailingComma&#34;</span>: <span style="color:#e6db74">&#34;es5&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;tabWidth&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;useTabs&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>.prettierignore</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>node_modules
</span></span><span style="display:flex;"><span>.next
</span></span><span style="display:flex;"><span>dist
</span></span><span style="display:flex;"><span><span style="color:#75715e"># shadcd/ui的目录</span>
</span></span><span style="display:flex;"><span>components/ui/
</span></span><span style="display:flex;"><span>hooks
</span></span></code></pre></div><p>命令行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>prettier --write .
</span></span></code></pre></div><h2 id="eslintconfigmjs-配置">eslint.config.mjs 配置</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">import</span> { <span style="color:#960050;background-color:#1e0010">dirname</span> } <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#e6db74">&#34;path&#34;</span><span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">import</span> { <span style="color:#960050;background-color:#1e0010">fileURLToPath</span> } <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#e6db74">&#34;url&#34;</span><span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">import</span> { <span style="color:#960050;background-color:#1e0010">FlatCompat</span> } <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#e6db74">&#34;@eslint/eslintrc&#34;</span><span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">const</span> <span style="color:#960050;background-color:#1e0010">__filename</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">fileURLToPath(import.meta.url);</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">const</span> <span style="color:#960050;background-color:#1e0010">__dirname</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">dirname(__filename);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">const</span> <span style="color:#960050;background-color:#1e0010">compat</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">new</span> <span style="color:#960050;background-color:#1e0010">FlatCompat(</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">baseDirectory:</span> <span style="color:#960050;background-color:#1e0010">__dirname,</span>
</span></span><span style="display:flex;"><span>}<span style="color:#960050;background-color:#1e0010">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">const</span> <span style="color:#960050;background-color:#1e0010">eslintConfig</span> <span style="color:#960050;background-color:#1e0010">=</span> [
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">...compat.config(</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">extends:</span> <span style="color:#960050;background-color:#1e0010">[</span><span style="color:#f92672">&#34;next/core-web-vitals&#34;</span>, <span style="color:#f92672">&#34;next/typescript&#34;</span><span style="color:#960050;background-color:#1e0010">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">rules:</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;react/no-unescaped-entities&#34;</span>: <span style="color:#e6db74">&#34;off&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;@next/next/no-page-custom-font&#34;</span>: <span style="color:#e6db74">&#34;off&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;@typescript-eslint/no-unused-vars&#34;</span>: <span style="color:#e6db74">&#34;off&#34;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">})</span>,
</span></span><span style="display:flex;"><span>]<span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">export</span> <span style="color:#960050;background-color:#1e0010">default</span> <span style="color:#960050;background-color:#1e0010">eslintConfig;</span>
</span></span></code></pre></div><h2 id="简单的ts">简单的TS</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Invoice</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">customer_id</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">amount</span>: <span style="color:#66d9ef">number</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">date</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// In TypeScript, this is called a string union type.
</span></span></span><span style="display:flex;"><span>  <span style="color:#75715e">// It means that the &#34;status&#34; property can only be one of the two strings: &#39;pending&#39; or &#39;paid&#39;.
</span></span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;pending&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;paid&#39;</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><ul>
<li>可以使用Prisma or Drizzle来生成database scheme对应的TS类型。</li>
<li>如果项目中存在TS，NextJS会自动安装必要的依赖和配置（应该是指<code>tsconfig.json</code>）。并且NextJS提供的<a href="https://nextjs.org/docs/app/building-your-application/configuring/typescript#typescript-plugin">TypeScript plugin</a>可以帮助你自动补全和保证类型安全。</li>
</ul>
<h2 id="样式">样式</h2>
<h3 id="全局样式">全局样式</h3>
<p>可以使用 <code>/app/ui/global.css</code> 文件将 CSS 规则添加到应用程序中的所有页面 —— 例如 CSS 重置规则（用来消除浏览器默认样式的差异）、链接等 HTML 元素的全栈范围样式等。（接受者是标签选择器，例如body、h1、p等。</p>
<p>您可以在应用程序的任何组件中导入 <code>global.css</code>，但通常最好将其添加到顶级组件中。在 <code>Next.js</code> 中，这是根布局（稍后会详细介绍）。通过导航到 <code>/app/layout.tsx</code> 并导入 <code>global.css</code> 文件，将全局样式添加到您的应用程序：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/layout.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;@/app/ui/global.css&#39;</span>;
</span></span></code></pre></div><p>golbal.css中的内容如下，主要包含 <code>@tailwind</code> 的三个指令，用于引入 <code>tailwindcss</code> 的基础样式、组件和工具类。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#75715e">/* /app/ui/global.css */</span>
</span></span><span style="display:flex;"><span>@<span style="color:#66d9ef">tailwind</span> <span style="color:#f92672">base</span>;
</span></span><span style="display:flex;"><span>@<span style="color:#66d9ef">tailwind</span> <span style="color:#f92672">components</span>;
</span></span><span style="display:flex;"><span>@<span style="color:#66d9ef">tailwind</span> <span style="color:#f92672">utilities</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;number&#39;</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">-moz-</span><span style="color:#66d9ef">appearance</span>: textfield;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">appearance</span>: textfield;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;number&#39;</span><span style="color:#f92672">]</span>::<span style="color:#a6e22e">-webkit-inner-spin-button</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">-webkit-</span><span style="color:#66d9ef">appearance</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;number&#39;</span><span style="color:#f92672">]</span>::<span style="color:#a6e22e">-webkit-outer-spin-button</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">-webkit-</span><span style="color:#66d9ef">appearance</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Tailwind</code> 是一个 CSS 框架，允许您直接在 TSX 标记中快速编写<a href="https://tailwindcss.com/docs/utility-first">实用程序类</a>，从而加快开发过程。通过给元素增加类名称，可以快速实现样式的修改。</p>
<p>当您使用<code>create-next-app</code>启动新项目时，<code>Next.js</code> 会询问您是否要使用 <code>Tailwind</code>。如果您选择yes ，<code>Next.js</code> 将自动安装必要的软件包并在您的应用程序中配置 <code>Tailwind</code>。</p>
<p>尽管 CSS 样式是全局共享的，但每个类都单独应用于每个元素。例如 <code>/app/page.tsx</code>，就使用了<code>Tailwind</code>的类名：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/page.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">AcmeLogo</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/acme-logo&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ArrowRightIcon</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@heroicons/react/24/outline&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Link</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/link&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Page() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// These are Tailwind classes:
</span></span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">main</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex min-h-screen flex-col p-6&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex h-20 shrink-0 items-end rounded-lg bg-blue-500 p-4 md:h-52&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="css-modules">CSS Modules</h3>
<p><code>CSS Modules</code> 是一种允许您在组件级别上使用 CSS 的技术，他使 CSS 类默认作用于组件的本地范围，从而降低样式冲突的风险。。Tailwind 和 CSS 模块是设计 Next.js 应用程序样式的两种最常见的方法。使用其中之一取决于您的偏好 - 您甚至可以在同一个应用程序中使用两者！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#75715e">/* /app/ui/home.module.css */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">shape</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border-bottom</span>: <span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border-left</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">transparent</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border-right</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">transparent</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">AcmeLogo</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/acme-logo&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ArrowRightIcon</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@heroicons/react/24/outline&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Link</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/link&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">styles</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/home.module.css&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Page() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">main</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex min-h-screen flex-col p-6&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">styles</span>.<span style="color:#a6e22e">shape</span>} /&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="使用-clsx-库切换类名">使用 <code>clsx</code> 库切换类名</h3>
<p><code>clsx</code> 是一个小型库，用于在 TSX 中动态切换类名。它允许您在组件中使用条件逻辑来决定是否应该添加或删除类名。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/ui/invoices/status.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">clsx</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;clsx&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">InvoiceStatus</span>({ <span style="color:#a6e22e">status</span> }<span style="color:#f92672">:</span> { <span style="color:#a6e22e">status</span>: <span style="color:#66d9ef">string</span> }) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">clsx</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;inline-flex items-center rounded-full px-2 py-1 text-sm&#39;</span>,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;bg-gray-100 text-gray-500&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;pending&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;bg-green-500 text-white&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;paid&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      )}
</span></span><span style="display:flex;"><span>    &gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span>)}
</span></span></code></pre></div><h2 id="优化字体和图像">优化字体和图像</h2>
<p>字体在网站设计中发挥着重要作用，但如果需要获取和加载字体文件，在项目中使用自定义字体可能会影响性能。<a href="https://vercel.com/blog/how-core-web-vitals-affect-seo">累积布局偏移</a>是 Google 用于评估网站性能和用户体验的指标。对于字体，当浏览器最初以后备字体或系统字体呈现文本，然后在加载后将其交换为自定义字体时，就会发生布局转换。这种交换可能会导致文本大小、间距或布局发生变化，从而移动其周围的元素。</p>
<p>当您使用<code>next/font</code>模块时，<code>Next.js</code> 会自动优化应用程序中的字体。它在构建时下载字体文件并将它们与其他静态资产一起托管。这意味着当用户访问您的应用程序时，不会出现会影响性能的额外网络请求字体。</p>
<h3 id="添加字体">添加字体</h3>
<p>让我们向您的应用程序添加自定义 <code>Google</code> 字体，看看它是如何工作的！在 <code>/app/ui</code> 文件夹中，创建一个名为 <code>fonts.ts</code> 的新文件。您将使用此文件来保留将在整个应用程序中使用的字体。从 <code>next/font/google</code> 模块导入 <code>Inter</code> 字体 - 这将是您的主要字体。然后，指定您要加载的子集。在这种情况下，&ldquo;拉丁语&rdquo;：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/ui/fonts.ts
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Inter</span>, <span style="color:#a6e22e">Lusitana</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/font/google&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">inter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Inter</span>({ <span style="color:#a6e22e">subsets</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;latin&#39;</span>] });
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lusitana</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Lusitana</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">weight</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;400&#39;</span>, <span style="color:#e6db74">&#39;700&#39;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">subsets</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;latin&#39;</span>],
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>最后将字体添加到 <code>/app/layout.tsx</code> 中的元素：看第二行import和body标签的<code>inter.className</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/layout.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;@/app/ui/global.css&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">inter</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/fonts&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">RootLayout</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">children</span>,
</span></span><span style="display:flex;"><span>}<span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">children</span>: <span style="color:#66d9ef">React.ReactNode</span>;
</span></span><span style="display:flex;"><span>}) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">body</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">inter</span>.<span style="color:#a6e22e">className</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> antialiased`</span>}&gt;{<span style="color:#a6e22e">children</span>}&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>通过将Inter添加到<code>&lt;body&gt;</code>元素，该字体将应用于整个应用程序（因为字体相关的css属性默认会继承给子元素）。在这里，您还添加了 <code>Tailwind antialiased</code> 平滑字体的类。没有必要使用这个类，但它增加了一个不错的感觉。可以到<a href="https://fonts.google.com/?lang=zh_Hans">Google 字体(简体中文)</a>搜索更多字体。</p>
<h3 id="添加图像">添加图像</h3>
<p>Next.js 可以在顶级 /public 文件夹下提供静态资源，例如图像。 /public 内的文件可以在您的应用程序中引用。使用常规 HTML，您可以添加图像，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/hero.png&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Screenshots of the dashboard project showing desktop version&#34;</span>
</span></span><span style="display:flex;"><span>/&gt;
</span></span></code></pre></div><p>但是，这意味着您必须手动：</p>
<ul>
<li>确保您的图像在不同的屏幕尺寸上都能响应。（响应式布局）</li>
<li>指定不同设备的图像尺寸。</li>
<li>防止图像加载时布局发生变化。</li>
<li>延迟加载用户视口之外的图像。</li>
</ul>
<p>图像优化是 Web 开发中的一个大主题，其本身可以被视为一个专业领域。您可以使用<code>next/image</code>组件自动优化图像，而不是手动实现这些优化。</p>
<p><code>&lt;Image&gt;</code>组件是<code>&lt;img&gt;</code>标签的扩展，他有一些自动优化的措施，例如：</p>
<ul>
<li>加载图像时自动防止布局移动。</li>
<li>调整图像大小以避免将大图像传送到具有较小视口的设备。</li>
<li>默认情况下延迟加载图像（图像在进入视口时加载）。</li>
<li>以现代格式（例如WebP）提供图像和AVIF ，当浏览器支持时。</li>
</ul>
<p>在 <code>/app/page.tsx</code> 文件中，从 <code>next/image</code> 导入组件。然后，在注释下添加图片:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/page.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">AcmeLogo</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/acme-logo&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ArrowRightIcon</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@heroicons/react/24/outline&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Link</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/link&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">lusitana</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/fonts&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Image</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/image&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Page() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex items-center justify-center p-6 md:w-3/5 md:px-28 md:py-12&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      {<span style="color:#75715e">/* Add Hero Images Here */</span>}
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">Image</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/hero-desktop.png&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span>{<span style="color:#ae81ff">1000</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span>{<span style="color:#ae81ff">760</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden md:block&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Screenshots of the dashboard project showing desktop version&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">Image</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/hero-mobile.png&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span>{<span style="color:#ae81ff">560</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span>{<span style="color:#ae81ff">620</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;block md:hidden&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Screenshot of the dashboard project showing mobile version&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//...
</span></span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在这里，您将width设置为1000 ， height设置为760像素。<strong>最好设置图像的width和height以避免布局移位，这些宽高比应该与源图像相同</strong>。您还会注意到 <code>hidden</code> 类用于从移动屏幕上的 DOM 中删除图像，以及 <code>md:block</code> 用于在桌面屏幕上显示图像。类似的 <code>block md:hidden</code> 用于在移动屏幕上显示图像，而在平板上隐藏图像。</p>
<h2 id="布局和页面">布局和页面</h2>
<p>Next.js 使用文件系统路由，其中​​文件夹用于创建嵌套路由。每个文件夹代表一个映射到 URL 段的路由段。您可以使用layout.tsx和page.tsx文件为每个路由创建单独的UI。</p>
<p><img src="/img/folders-to-url-segments.avif" alt=""></p>
<h3 id="创建页面">创建页面</h3>
<p>page.tsx是一个特殊的 Next.js 文件，它导出 React 组件，并且需要它才能访问路由。在您的应用程序中，您已经有一个页面文件： <code>/app/page.tsx</code> —— 这是与路径/关联的主页。要创建嵌套路由，您可以将文件夹相互嵌套并在其中添加 page.tsx 文件。例如：/app/dashboard/page.tsx 与 /dashboard 路径关联。让我们创建页面来看看它是如何工作的！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Page() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">p</span>&gt;<span style="color:#a6e22e">Dashboard</span> <span style="color:#a6e22e">Page</span>&lt;/<span style="color:#f92672">p</span>&gt;;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>现在，确保开发服务器正在运行并访问 http://localhost:3000/dashboard。您应该看到&quot;仪表板页面&quot;文本。</p>
<h3 id="创建布局">创建布局</h3>
<p>仪表板具有某种跨多个页面共享的导航。在 Next.js 中，您可以使用特殊的layout.tsx文件来创建在多个页面之间共享的 UI。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/dashboard/layout.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">SideNav</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/dashboard/sidenav&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Layout</span>({ <span style="color:#a6e22e">children</span> }<span style="color:#f92672">:</span> { <span style="color:#a6e22e">children</span>: <span style="color:#66d9ef">React.ReactNode</span> }) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex h-screen flex-col md:flex-row md:overflow-hidden&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-full flex-none md:w-64&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">SideNav</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex-grow p-6 md:overflow-y-auto md:p-12&#34;</span>&gt;{<span style="color:#a6e22e">children</span>}&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>/app/layout.tsx</code> 是根布局，并且是必须的。</p>
<h2 id="优化导航">优化导航</h2>
<p>传统的<code>&lt;a&gt;</code> HTML 元素会导致全页面刷新。在 Next.js 中，您可以使用用于在应用程序中的页面之间链接的组件。允许您使用 JavaScript 进行客户端导航。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">UserGroupIcon</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">HomeIcon</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">DocumentDuplicateIcon</span>,
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@heroicons/react/24/outline&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Link</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/link&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">NavLinks() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;&gt;
</span></span><span style="display:flex;"><span>      {<span style="color:#a6e22e">links</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">link</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">LinkIcon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">icon</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">Link</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">key</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">name</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">href</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex h-[48px] grow items-center justify-center gap-2 rounded-md bg-gray-50 p-3 text-sm font-medium hover:bg-sky-100 hover:text-blue-600 md:flex-none md:justify-start md:p-2 md:px-3&#34;</span>
</span></span><span style="display:flex;"><span>          &gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">LinkIcon</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-6&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden md:block&#34;</span>&gt;{<span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">name</span>}&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#f92672">Link</span>&gt;
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>      })}
</span></span><span style="display:flex;"><span>    &lt;/&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>为了改善导航体验，Next.js 自动按路线段对应用程序进行代码分割。这与传统的 React SPA不同，浏览器在初始加载时加载所有应用程序代码。</p>
<p>按路由拆分代码意味着页面变得孤立。如果某个页面抛出错误，应用程序的其余部分仍然可以工作。</p>
<p>此外，在生产中，只要<!-- raw HTML omitted -->组件出现在浏览器的视口中，Next.js 就会自动在后台预取链接路由的代码。当用户单击链接时，目标页面的代码将已经在后台加载，这使得页面转换几乎是即时的！</p>
<p>常见的 UI 模式是显示活动链接以向用户指示他们当前所在的页面。为此，您需要从 URL 获取用户的当前路径。 Next.js 提供了一个名为usePathname()的钩子，您可以使用它来检查路径并实现此模式。由于 <code>usePathname()</code> 是一个钩子，因此您需要将 <code>nav-links.tsx</code> 转换为客户端组件。将 React 的&quot;use client&quot;指令添加到文件顶部，然后从 <code>next/navigation</code> 导入<code> usePathname()</code>，并且使用clsx库在链接处于活动状态时有条件地应用类名。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#e6db74">&#39;use client&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">UserGroupIcon</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">HomeIcon</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">DocumentDuplicateIcon</span>,
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@heroicons/react/24/outline&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Link</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/link&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">usePathname</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next/navigation&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">clsx</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;clsx&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">NavLinks() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pathname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">usePathname</span>();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;&gt;
</span></span><span style="display:flex;"><span>      {<span style="color:#a6e22e">links</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">link</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">LinkIcon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">icon</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">Link</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">key</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">name</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">href</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">clsx</span>(
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;flex h-[48px] grow items-center justify-center gap-2 rounded-md bg-gray-50 p-3 text-sm font-medium hover:bg-sky-100 hover:text-blue-600 md:flex-none md:justify-start md:p-2 md:px-3&#39;</span>,
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;bg-sky-100 text-blue-600&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pathname</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">href</span>,
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>            )}
</span></span><span style="display:flex;"><span>          &gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">LinkIcon</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-6&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden md:block&#34;</span>&gt;{<span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">name</span>}&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#f92672">Link</span>&gt;
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>      })}
</span></span><span style="display:flex;"><span>    &lt;/&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="使用服务器组件server-components获取数据">使用服务器组件(Server Components)获取数据</h2>
<p>默认情况下，Next.js 应用程序使用 <strong>React Server Components</strong>。使用服务器组件获取数据是一种相对较新的方法，使用它们有一些好处：</p>
<ul>
<li>服务器组件支持 Promise，为数据获取等异步任务提供更简单的解决方案。您可以使用async/await语法，而无需使用useEffect 、 useState或数据获取库。</li>
<li>服务器组件在服务器上执行，因此您可以将昂贵的数据获取和逻辑保留在服务器上，并且仅将结果发送到客户端。</li>
<li>如前所述，由于服务器组件在服务器上执行，因此您可以直接查询数据库，而无需额外的 API 层。</li>
</ul>
<p>NextJS的教程主要是如何使用SQL查询数据，但我想用API来获取数据。这里整理下通用的一些东西。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/dashboard/page.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Card</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/dashboard/cards&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">RevenueChart</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/dashboard/revenue-chart&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">LatestInvoices</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/dashboard/latest-invoices&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">lusitana</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/fonts&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fetchRevenue</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fetchLatestInvoices</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fetchCardData</span>,
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/lib/data&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Page() {</span> <span style="color:#75715e">// async方法，从而可以使用async/await语法
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">revenue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchRevenue</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">latestInvoices</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchLatestInvoices</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">numberOfInvoices</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">numberOfCustomers</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">totalPaidInvoices</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">totalPendingInvoices</span>,
</span></span><span style="display:flex;"><span>  } <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchCardData</span>();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">main</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">lusitana</span>.<span style="color:#a6e22e">className</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> mb-4 text-xl md:text-2xl`</span>}&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Dashboard</span>
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid gap-6 sm:grid-cols-2 lg:grid-cols-4&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Collected&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">totalPaidInvoices</span>} <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;collected&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Pending&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">totalPendingInvoices</span>} <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pending&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Total Invoices&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">numberOfInvoices</span>} <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;invoices&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Total Customers&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">numberOfCustomers</span>}
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;customers&#34;</span>
</span></span><span style="display:flex;"><span>        /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">RevenueChart</span> <span style="color:#a6e22e">revenue</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">revenue</span>} /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">LatestInvoices</span> <span style="color:#a6e22e">latestInvoices</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">latestInvoices</span>} /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">main</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 获取数据的一个例子，主要关注如何使用Promise和setTimeout
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fetchRevenue() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Artificially delay a response for demo purposes.
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Don&#39;t do this in production :)
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// console.log(&#39;Fetching revenue data...&#39;);
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// await new Promise((resolve) =&gt; setTimeout(resolve, 3000));
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sql</span>&lt;<span style="color:#f92672">Revenue</span>&gt;<span style="color:#e6db74">`SELECT * FROM revenue`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// console.log(&#39;Data fetch completed after 3 seconds.&#39;);
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">rows</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Database Error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Failed to fetch revenue data.&#39;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>可以使用 <code>Promise.all()</code> 或 <code>Promise.allSettled()</code> 来避免请求瀑布：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fetchCardData() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">invoiceCountPromise</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sql</span><span style="color:#e6db74">`SELECT COUNT(*) FROM invoices`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">customerCountPromise</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sql</span><span style="color:#e6db74">`SELECT COUNT(*) FROM customers`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">invoiceStatusPromise</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sql</span><span style="color:#e6db74">`SELECT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         SUM(CASE WHEN status = &#39;paid&#39; THEN amount ELSE 0 END) AS &#34;paid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         SUM(CASE WHEN status = &#39;pending&#39; THEN amount ELSE 0 END) AS &#34;pending&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         FROM invoices`</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">Promise</span>.<span style="color:#a6e22e">all</span>([
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">invoiceCountPromise</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">customerCountPromise</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">invoiceStatusPromise</span>,
</span></span><span style="display:flex;"><span>    ]);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="静态渲染和动态渲染">静态渲染和动态渲染</h2>
<h3 id="什么是静态渲染">什么是静态渲染？</h3>
<p>通过静态渲染，数据获取和渲染发生在构建时（部署时）或重新验证数据时在服务器上。每当用户访问您的应用程序时，就会提供缓存的结果。静态渲染有几个好处：</p>
<ul>
<li>更快的网站 - 预渲染的内容可以缓存并在全球范围内分发。这可以确保世界各地的用户可以更快、更可靠地访问您网站的内容。</li>
<li>减少服务器负载 - 由于内容被缓存，您的服务器不必为每个用户请求动态生成内容。</li>
<li>SEO - 预渲染的内容更容易让搜索引擎爬虫索引，因为内容在页面加载时就已经可用。这可以提高搜索引擎排名。</li>
</ul>
<h3 id="什么是动态渲染">什么是动态渲染？</h3>
<p>通过动态呈现，内容会在请求时（当用户访问页面时）在服务器上为每个用户呈现。动态渲染有几个好处：</p>
<ul>
<li>实时数据 - 动态渲染允许您的应用程序显示实时或经常更新的数据。这对于数据经常变化的应用程序来说是理想的选择。</li>
<li>用户特定的内容 - 更容易提供个性化内容（例如仪表板或用户配置文件），并根据用户交互更新数据。</li>
<li>请求时间信息 - 动态呈现允许您访问只能在请求时知道的信息，例如 cookie 或 URL 搜索参数。</li>
</ul>
<h2 id="streaming-渐进式渲染">Streaming 渐进式渲染</h2>
<p>通过流式传输，您可以防止缓慢的数据请求阻塞整个页面。这允许用户查看页面的部分内容并与之交互，而无需等待所有数据加载后再向用户显示任何 UI。流式处理与 React 的组件模型配合得很好，因为每个组件都可以被视为一个块。在 Next.js 中实现流式传输有两种方法：</p>
<ol>
<li>在页面级别，使用loading.tsx 文件。</li>
<li>对于特定的组件，用 <code>&lt;Suspense&gt;</code></li>
</ol>
<h3 id="使用-loadingtsx-文件">使用 loading.tsx 文件</h3>
<p><code>loading.tsx</code> 是一个基于 <code>Suspense</code> 构建的特殊 <code>Next.js</code> 文件，它允许您创建后备 UI 以在页面内容加载时显示为替换。</p>
<p>最基本的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/dashboard/loading.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Loading() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">div</span>&gt;<span style="color:#a6e22e">Loading</span>...&lt;/<span style="color:#f92672">div</span>&gt;;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>添加加载骨架：加载骨架是 UI 的简化版本。许多网站使用它们作为占位符（或后备）来向用户指示内容正在加载。您在loading.tsx中添加的任何UI都将作为静态文件的一部分嵌入，并首先发送。然后，其余的动态内容将从服务器流式传输到客户端。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// /app/dashboard/loading.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">DashboardSkeleton</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/skeletons&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Loading() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">DashboardSkeleton</span> /&gt;;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// /app/ui/skeletons.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">DashboardSkeleton() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">shimmer</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> relative mb-4 h-8 w-36 overflow-hidden rounded-md bg-gray-100`</span>}
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid gap-6 sm:grid-cols-2 lg:grid-cols-4&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">CardSkeleton</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">CardSkeleton</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">CardSkeleton</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">CardSkeleton</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">RevenueChartSkeleton</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">LatestInvoicesSkeleton</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="/img/loading-page-with-skeleton.avif" alt=""></p>
<p>现在还有个问题，这个loading的骨架界面会对下面的页面也生效。我们可以通过路由组来改变这一点。在仪表板文件夹内创建一个名为 /(overview) 的新文件夹。然后，将 loading.tsx 和 page.tsx 文件移至文件夹内：路由组允许您将文件组织到逻辑组中，而不影响 URL 路径结构。当您使用括号()创建新文件夹时，该名称不会包含在 URL 路径中。因此/dashboard/(overview)/page.tsx变为/dashboard 。</p>
<p><img src="/img/route-group.avif" alt=""></p>
<h3 id="流式传输动态组件">流式传输动态组件</h3>
<p>使用 <code>&lt;Suspense&gt;</code> 包裹原来的组件，并添加fallback为骨架即可。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Card</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/dashboard/cards&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">RevenueChart</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/dashboard/revenue-chart&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">LatestInvoices</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/dashboard/latest-invoices&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">lusitana</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/fonts&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">fetchLatestInvoices</span>, <span style="color:#a6e22e">fetchCardData</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/lib/data&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Suspense</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">RevenueChartSkeleton</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;@/app/ui/skeletons&#39;</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Page() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">latestInvoices</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchLatestInvoices</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">numberOfInvoices</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">numberOfCustomers</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">totalPaidInvoices</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">totalPendingInvoices</span>,
</span></span><span style="display:flex;"><span>  } <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchCardData</span>();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">main</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">lusitana</span>.<span style="color:#a6e22e">className</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> mb-4 text-xl md:text-2xl`</span>}&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Dashboard</span>
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid gap-6 sm:grid-cols-2 lg:grid-cols-4&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Collected&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">totalPaidInvoices</span>} <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;collected&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Pending&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">totalPendingInvoices</span>} <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pending&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Total Invoices&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">numberOfInvoices</span>} <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;invoices&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Card</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Total Customers&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">numberOfCustomers</span>}
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;customers&#34;</span>
</span></span><span style="display:flex;"><span>        /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Suspense</span> <span style="color:#a6e22e">fallback</span><span style="color:#f92672">=</span>{&lt;<span style="color:#f92672">RevenueChartSkeleton</span> /&gt;}&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">RevenueChart</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">Suspense</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">LatestInvoices</span> <span style="color:#a6e22e">latestInvoices</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">latestInvoices</span>} /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">main</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="部分预渲染partial-prerendering-ppr和增量静态生成incremental-static-regeneration-isr">部分预渲染Partial Prerendering (PPR)和增量静态生成Incremental Static Regeneration (ISR)</h2>
<p>Next.js 14 引入了部分预渲染的实验版本 - 一种新的渲染模型，允许您在同一路径中结合静态和动态渲染的优点。例如：</p>
<p>当用户访问某条路线时：</p>
<ul>
<li>提供包含导航栏和产品信息的静态路由的外壳，确保快速初始加载。</li>
<li>外壳留下了一些空洞，动态内容（例如购物车和推荐产品）将异步加载。</li>
<li>这些空洞将并行移步加载，从而减少总体加载时间</li>
</ul>
<h3 id="部分预渲染如何工作">部分预渲染如何工作？</h3>
<p>部分预渲染使用 React 的 Suspense（您在上一章中了解过）来推迟应用程序的渲染部分，直到满足某些条件（例如加载数据）。Suspense fallback 与静态内容一起嵌入到初始 HTML 文件中。在构建时（或revalidation期间），静态内容被预渲染以创建静态外壳。动态内容的呈现被推迟，直到用户请求该页面。</p>
<p>将组件包装在 Suspense 中并不会使组件本身变得动态，而是 Suspense 被用作静态和动态代码之间的边界。</p>
<h3 id="启用部分预渲染">启用部分预渲染</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// next.config.ts
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#66d9ef">type</span> { <span style="color:#a6e22e">NextConfig</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;next&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nextConfig</span>: <span style="color:#66d9ef">NextConfig</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* config options here */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">experimental</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ppr</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;incremental&#39;</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">nextConfig</span>;
</span></span></code></pre></div><p>然后在page.tsx中增加这个</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">experimental_ppr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span></code></pre></div><p>就是这样。您可能在开发中看不到应用程序的差异，但您应该注意到生产中的性能改进。 Next.js 将预渲染路由的静态部分，并推迟动态部分，直到用户请求它们。部分预渲染的优点在于您无需更改代码即可使用它。只要您使用 Suspense 包装路线的动态部分，Next.js 就会知道路线的哪些部分是静态的，哪些部分是动态的。我们相信 PPR 有潜力成为 Web 应用程序的默认渲染模型，汇集了静态站点和动态渲染的优点。然而，它仍处于实验阶段。我们希望将来能够稳定它，并使其成为 Next.js 构建的默认方式。</p>
<h2 id="使用客户端组件添加搜索和分页并通过客户端重定向修改url并保持input的输入和input关联以及输入的防抖">使用客户端组件添加搜索和分页，并通过客户端重定向修改url，并保持input的输入和input关联，以及输入的防抖</h2>
<p><a href="https://nextjs.org/learn/dashboard-app/adding-search-and-pagination">https://nextjs.org/learn/dashboard-app/adding-search-and-pagination</a></p>
<h2 id="route-handlers">Route Handlers</h2>
<p>在 Next.js 中，您可以使用路由处理程序创建 API 端点。https://nextjs.org/docs/app/building-your-application/routing/route-handlers</p>
<h2 id="其他文档">其他文档</h2>
<p><a href="https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#dynamic">https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#dynamic</a></p>
<p><a href="https://nextjs.org/docs/app/building-your-application/data-fetching">https://nextjs.org/docs/app/building-your-application/data-fetching</a></p>
<p><a href="https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration">https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration</a></p>
<p><a href="https://nextjs.org/docs/app/building-your-application/caching#data-cache">https://nextjs.org/docs/app/building-your-application/caching#data-cache</a></p>
<p><a href="https://nextjs.org/docs/pages/building-your-application/data-fetching/get-server-side-props">https://nextjs.org/docs/pages/building-your-application/data-fetching/get-server-side-props</a></p>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/golang/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Golang笔记</span>
    </a>
    
    
    <a href="/posts/mysql9-docker-ssl/" class="navigation-next">
      <span class="navigation-tittle">MySQL9 docker容器配置SSL</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  


</article>


  </div>
<style>
  .content.container {
        width: 100%;
        max-width: none;
        height: calc(100vh - var(--sidebar-height, 49px));
        border: none;
        display: block;
        overflow-y: auto;
        box-sizing: border-box;
        margin-left: 0;
        margin-right: 0;
  }

  body:not(.type-iframe) .content.container {
        padding-left: max(1.5rem, calc((100% - var(--content-max-width, 38rem)) / 2));
        padding-right: max(1.5rem, calc((100% - var(--content-max-width, 38rem)) / 2));
  }
</style>
<script>
    (function () {
        var contentSelector = '.content.container';
        var rafId = 0;
        var resizeDebounceTimer = 0;
        var pendingHashScroll = false;

        function getHashTarget() {
            var hash = window.location.hash;
            var targetId = '';

            if (!hash || hash === '#') {
                return null;
            }

            targetId = hash.slice(1);
            try {
                targetId = decodeURIComponent(targetId);
            } catch (e) {
                
            }

            return document.getElementById(targetId);
        }

        function scrollToHashTarget() {
            var target = getHashTarget();
            if (!target) {
                return;
            }
            try {
                target.scrollIntoView({ block: 'start', inline: 'nearest' });
            } catch (e) {
                target.scrollIntoView(true);
            }
        }

        function applyPendingHashScroll() {
            if (!pendingHashScroll) {
                return;
            }
            pendingHashScroll = false;
            scrollToHashTarget();
        }

        function resizeContentHeight() {
            var content = document.querySelector(contentSelector);
            if (!content) {
                return;
            }
            var rect = content.getBoundingClientRect();
            var available = window.innerHeight - rect.top;
            if (available < 0) {
                available = 0;
            }
            content.style.height = available + 'px';
            applyPendingHashScroll();
        }

        function scheduleResize() {
            if (rafId) {
                return;
            }
            rafId = window.requestAnimationFrame(function () {
                rafId = 0;
                resizeContentHeight();
            });
        }

        function scheduleResizeDebounced(delay) {
            window.clearTimeout(resizeDebounceTimer);
            resizeDebounceTimer = window.setTimeout(scheduleResize, delay || 120);
        }

        function requestHashScroll() {
            if (!window.location.hash || window.location.hash === '#') {
                return;
            }
            pendingHashScroll = true;
            scheduleResize();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () {
                scheduleResize();
                requestHashScroll();
            }, { once: true });
        } else {
            scheduleResize();
            requestHashScroll();
        }

        window.addEventListener('load', function () {
            scheduleResize();
            requestHashScroll();
        });
        window.addEventListener('pageshow', function () {
            scheduleResize();
            requestHashScroll();
        });
        window.addEventListener('hashchange', requestHashScroll);
        window.addEventListener('resize', function () {
            scheduleResizeDebounced(120);
        });

        var menuToggle = document.getElementById('menuToggle');
        if (menuToggle) {
            menuToggle.addEventListener('change', function () {
                scheduleResize();
                window.setTimeout(scheduleResize, 250);
            });
        }
    })();
</script>
  
    



<script defer src="/js/all.js" crossorigin="anonymous"></script>

    
    
    <script src="/js/highlight.min.js"></script>
    <script src="/js/languages/dos.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.highlightAll();
    </script>
    

<style>
    .code-block-wrapper {
        position: relative;
    }
    .copy-code-button {
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 6px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s, background 0.3s;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .copy-code-button svg {
        width: 16px;
        height: 16px;
        fill: #fff;
        transition: fill 0.3s;
    }
    .code-block-wrapper:hover .copy-code-button {
        opacity: 1;
    }
    .copy-code-button:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    .copy-code-button.copied {
        background: rgba(46, 160, 67, 0.8);
        border-color: rgba(46, 160, 67, 1);
    }
    .copy-code-button.copied svg {
        fill: #fff;
    }
</style>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        
        document.querySelectorAll('pre code').forEach(function(codeBlock) {
            var pre = codeBlock.parentNode;
            
            
            if (pre.parentNode.classList.contains('code-block-wrapper')) {
                return;
            }
            
            
            var wrapper = document.createElement('div');
            wrapper.className = 'code-block-wrapper';
            pre.parentNode.insertBefore(wrapper, pre);
            wrapper.appendChild(pre);
            
            
            var button = document.createElement('button');
            button.className = 'copy-code-button';
            button.innerHTML = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';
            button.setAttribute('aria-label', '复制代码');
            button.setAttribute('title', '复制代码');
            
            var copyIcon = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';
            var checkIcon = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path></svg>';
            
            
            button.addEventListener('click', function() {
                var code = codeBlock.textContent;
                navigator.clipboard.writeText(code).then(function() {
                    button.innerHTML = checkIcon;
                    button.classList.add('copied');
                    button.setAttribute('aria-label', '已复制');
                    button.setAttribute('title', '已复制');
                    setTimeout(function() {
                        button.innerHTML = copyIcon;
                        button.classList.remove('copied');
                        button.setAttribute('aria-label', '复制代码');
                        button.setAttribute('title', '复制代码');
                    }, 2000);
                }).catch(function(err) {
                    console.error('复制失败:', err);
                });
            });
            
            wrapper.appendChild(button);
        });
    });
</script>




    



</body>

</html>
