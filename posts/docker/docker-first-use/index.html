<!DOCTYPE html>
<html lang="zh-CN">

    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    
    <link rel="canonical" href="https://www.arloor.com/posts/docker/docker-first-use/">
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.157.0">

    
    
    

<title>docker使用笔记 • ARLOOR</title>
<meta name="description" content="今天，你学习了吗">
<meta name="keywords" content="刘港欢, arloor, moontell">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="docker使用笔记">
  <meta name="twitter:description" content="docker 很火，所以我想入门。这篇文章是记录学习的，所以可能很乱，称为杂说">
      <meta name="twitter:site" content="@njulgh">

<meta property="og:url" content="https://www.arloor.com/posts/docker/docker-first-use/">
  <meta property="og:site_name" content="ARLOOR">
  <meta property="og:title" content="docker使用笔记">
  <meta property="og:description" content="docker 很火，所以我想入门。这篇文章是记录学习的，所以可能很乱，称为杂说">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-01-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2019-01-02T00:00:00+00:00">
    <meta property="article:tag" content="Program">


    





<link rel="stylesheet" href="/styles/atom-one-dark.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.debf1b963c1830f6b9b96ee48c2b4a22c31c7c3885a87bed290c0e198fc6a08d.css" integrity="sha256-3r8bljwYMPa5uW7kjCtKIsMcfDiFqHvtKQwOGY/GoI0=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">




<link rel="stylesheet" href="/scss/hugo-toc.6b7222b4ddd3cebd47d144a2e37ade6cbbb64f47e31d8feac655896156ade206.css" integrity="sha256-a3IitN3Tzr1H0USi43rebLu2T0fjHY/qxlWJYVat4gY=">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>



<body class="  ">
  
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="/">
          
          ARLOOR
          
        </a>
      </span>
      <a href="/">
        
        
        <div class="author-image">
          <img src="/img/head.jpeg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
        
      </a>
      
      <p class="site__description">
         都是瞎写的 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">ARLOOR</label>
      <div class="menu-content menu-content--mobile">
        <div class="show-in-small">
          <a href="/">
            
            
            <div class="author-image">
              <img src="/img/head.jpeg" alt="Author Image"
                class="img--circle img--headshot element--center">
            </div>
            
            
          </a>
        </div>
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>文章</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/">
						<span>分类</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>关于我</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/grafana-iframe">
						<span>Grafana</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/net-iframe">
						<span>网速监控</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/nat">
						<span>NAT规则</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/stock">
						<span>股票监控</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://x.com/njulgh" rel="me" target="_blank"><i class="fa-brands fa-x-twitter fa-lg"></i></a>
	
	
	
	
	
	<a href="https://github.com/arloor" rel="me" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<a href="https://t.me/never_contact_me" rel="me" target="_blank"><i class="fa-brands fa-telegram fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="mailto:admin@arloor.com" rel="me" target="_blank"><i class="fa-solid fa-at fa-lg"></i></a>
	
	
	
	
</section>
      </div>
    </div>
    <div class="menu-content menu-content--desktop">
      <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>文章</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/">
						<span>分类</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>关于我</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/grafana-iframe">
						<span>Grafana</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/net-iframe">
						<span>网速监控</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/nat">
						<span>NAT规则</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/stock">
						<span>股票监控</span>
					</a>
				</li>
			 
		
	</ul>
</div>

    </div>
    <div class="social-wrap social-wrap--desktop">
      <section class="social">
	
	<a href="https://x.com/njulgh" rel="me" target="_blank"><i class="fa-brands fa-x-twitter fa-lg"></i></a>
	
	
	
	
	
	<a href="https://github.com/arloor" rel="me" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<a href="https://t.me/never_contact_me" rel="me" target="_blank"><i class="fa-brands fa-telegram fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="mailto:admin@arloor.com" rel="me" target="_blank"><i class="fa-solid fa-at fa-lg"></i></a>
	
	
	
	
</section>
    </div>
    
<div class="copyright">
  &copy; 2026 arloor
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/arloor/hyde-arloor">hyde-arloor</a>.
</div>


  </div>
</div>

  <div class="content container">
    
    
<article>
  <header>
    <h1>docker使用笔记</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jan 2, 2019
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/docker">DOCKER</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/program">program</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>


  </header>
  
  
  
    <div class="toc-wrapper">
      <input type="checkbox" id="tocToggle">
      <label for="tocToggle">Table of Content</label>
      
          <nav id="TableOfContents">
  <ul>
    <li><a href="#设置-docker-命令使用代理">设置 docker 命令使用代理</a></li>
    <li><a href="#设置国内镜像">设置国内镜像</a></li>
    <li><a href="#配置不需要-sudo">配置不需要 sudo</a></li>
  </ul>

  <ul>
    <li><a href="#编写-dockerfile">编写 Dockerfile</a></li>
    <li><a href="#构建-image容器运行">构建 image、容器、运行</a></li>
    <li><a href="#进入容器一探究竟">进入容器一探究竟</a></li>
  </ul>

  <ul>
    <li><a href="#以-centos-为基础构建-image">以 centos 为基础构建 image</a></li>
    <li><a href="#用基础映像启动一个容器并进行修改">用基础映像启动一个容器，并进行修改</a>
      <ul>
        <li><a href="#runsh">run.sh</a></li>
      </ul>
    </li>
    <li><a href="#持久化修改好的容器">持久化修改好的容器</a></li>
    <li><a href="#运行这个完成体映像">运行这个完成体映像</a></li>
    <li><a href="#进入这个正在在运行的容器">进入这个正在在运行的容器</a></li>
    <li><a href="#删除容器镜像">删除容器、镜像</a></li>
  </ul>

  <ul>
    <li><a href="#安装-docker-ce">安装 docker-ce</a></li>
    <li><a href="#iptables">iptables</a></li>
  </ul>
</nav>
      
    </div>
  
  
  <div class="post">
    <p>docker 很火，所以我想入门。这篇文章是记录学习的，所以可能很乱，称为杂说</p>
<h1 id="变成自己的-docker">变成自己的 docker</h1>
<p>为了用的顺手，做两方面调整：配置使用代理、设置不需要 sudo</p>
<h2 id="设置-docker-命令使用代理">设置 docker 命令使用代理</h2>
<p>在之前的博客中，我多次提到使用<code>. pass</code>来设置 shell 的代理，但是这对 docker 没有作用。</p>
<p>在使用 systemd 的 linux 发行版中（比如 ubuntu 18.04），可以这样配置：参见<a href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy">#httphttps-proxy</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir -p /etc/systemd/system/docker.service.d
</span></span><span style="display:flex;"><span>sudo touch /etc/systemd/system/docker.service.d/http-proxy.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ! grep HTTP_PROXY /etc/systemd/system/docker.service.d/http-proxy.conf;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>cat &gt;&gt; /etc/systemd/system/docker.service.d/http-proxy.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Environment=&#34;HTTP_PROXY=http://127.0.0.1:3128/&#34; &#34;HTTPS_PROXY=http://127.0.0.1:3128/&#34; &#34;NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl restart docker
</span></span></code></pre></div><h2 id="设置国内镜像">设置国内镜像</h2>
<p>除了上面的设置代理，还可以配置国内镜像</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat &gt; /etc/docker/daemon.json <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;registry-mirrors&#34;: [&#34;https://registry.docker-cn.com&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo systemctl restart docker
</span></span></code></pre></div><h2 id="配置不需要-sudo">配置不需要 sudo</h2>
<pre tabindex="0"><code>sudo groupadd docker
sudo usermod -aG docker $USER
</code></pre><p>解释：</p>
<p>The Docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The Docker daemon always runs as the root user.</p>
<p>If you don’t want to preface the docker command with sudo, create a Unix group called docker and add users to it. When the Docker daemon starts, it creates a Unix socket accessible by members of the docker group.</p>
<p>重启一下电脑（虚拟机/服务器）这样就可以不加 sudo 地使用 docker 了。如果在运行 docker 命令时报：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>WARNING: Error loading config file: /home/user/.docker/config.json -
</span></span><span style="display:flex;"><span>stat /home/user/.docker/config.json: permission denied
</span></span></code></pre></div><p>是因为<code>~/.docker/</code>directory was created with incorrect permissions due to the sudo commands.</p>
<p>这时候就把这个文件夹删掉好了。或者参照官网：</p>
<p>To fix this problem, either remove the ~/.docker/ directory (it is recreated automatically, but any custom settings are lost), or change its ownership and permissions using the following commands:</p>
<pre tabindex="0"><code>$ sudo chown &#34;$USER&#34;:&#34;$USER&#34; /home/&#34;$USER&#34;/.docker -R
$ sudo chmod g+rwx &#34;$HOME/.docker&#34; -R
</code></pre><h1 id="java-的简单-docker-使用">java 的简单 docker 使用</h1>
<p>以自己的 proxyserver 为例子：</p>
<h2 id="编写-dockerfile">编写 Dockerfile</h2>
<pre tabindex="0"><code>mkdir docker-proxyserver
# 里面放Dockerfile和proxyserver-1.2-jar-with-dependencies.jar
</code></pre><p>Dockerfile 内容：</p>
<pre tabindex="0"><code>FROM java:8
COPY . /var/www/java
WORKDIR /var/www/java
#RUN java -jar proxyserver-1.2-jar-with-dependencies.jar
CMD [&#34;java&#34;, &#34;-jar&#34;,&#34;proxyserver-1.2-jar-with-dependencies.jar&#34;]
</code></pre><p>解释：</p>
<ol>
<li>以 java8 为基础映像</li>
<li>将该文件夹下所有文件复制到容器的/var/www/java 文件夹</li>
<li>已/var/www/java 作为工作目录</li>
<li>被注释掉了：不需要在 cmd 前做什么</li>
<li>CMD: docker run 会执行这行命令：启动 proxyserver</li>
</ol>
<h2 id="构建-image容器运行">构建 image、容器、运行</h2>
<pre tabindex="0"><code>cd docker-proxyserver
#构建
docker build -t proxyserver .
运行
docker run proxyserver

#下面就可以看到proxyserver运行的日志了
2019-01-01 15:09:17.312 [main] INFO  com.arloor.proxyserver.ServerProxyBootStrap - 开启代理 端口:8080
</code></pre><h2 id="进入容器一探究竟">进入容器一探究竟</h2>
<p>上面的容器，最后通过 CMD 执行了 java -jar 命令，虽然运行了程序，但容器的运行是个黑盒。现在开始进入这个黑盒。</p>
<p>注释掉 DockerFile 的最后一行：</p>
<pre tabindex="0"><code>CMD [&#34;java&#34;, &#34;-jar&#34;,&#34;proxyserver-1.2-jar-with-dependencies.jar&#34;]
</code></pre><p>重新构建映像，并以交互模式 run 容器：</p>
<pre tabindex="0"><code>sudo docker build -t proxyserver .
docker run -it  proxyserver /bin/bash 　＃-it表示交互模式
#或者：docker run -it  proxyserver
</code></pre><p>之后的 terminal:</p>
<pre tabindex="0"><code>x1@carbon:~/docker-proxyserver$ docker run -it  proxyserver /bin/bash
root@2afdacfb0dff:/var/www/java# ls
Dockerfile  proxyserver-1.2-jar-with-dependencies.jar
root@2afdacfb0dff:/var/www/java# uname -a
Linux 2afdacfb0dff 4.15.0-43-generic #46-Ubuntu SMP Thu Dec 6 14:45:28 UTC 2018 x86_64 GNU/Linux
root@2afdacfb0dff:/var/www/java# echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
root@2afdacfb0dff:/var/www/java# reboot
Failed to talk to init daemon.
</code></pre><p>这就像一个虚拟机啊。可以看出不同的大概是最后一个命令<code>reboot</code>的执行结果：Failed to talk to init daemon.可以看出进程隔离这个原理的影子吧</p>
<h1 id="自己改造一个镜像">自己改造一个镜像</h1>
<p>上面我们已经知道了，是可以进入镜像执行一些命令的，比如执行一些解压、设置 PATH、新建软连接都是可以的，这就是安装软件的过程了。</p>
<p>而<code>docker commit</code>则允许<code>Create a new image from a container's changes</code>：由一个被修改过的容器创建一个映像。这给我们提供了魔改镜像、自定义镜像的能力。</p>
<p>以一个需要 nodejs8 和 java ８的项目为例：我们以 centos 为基础映像，启动容器，然后进行魔改（安装 jdk 和 node）。</p>
<h2 id="以-centos-为基础构建-image">以 centos 为基础构建 image</h2>
<p>Dockerfile:</p>
<pre tabindex="0"><code>FROM centos:7
COPY . /app
WORKDIR /app
EXPOSE 4000
</code></pre><p>集成 centos7 映像，将本文件夹下的所有文件（是项目代码）复制到容器的<code>/app</code>文件下。这里也包括了 npm_modules。最后定义暴露 4000 端口</p>
<p>构建映像：</p>
<pre tabindex="0"><code>docker build -t simlogin-with-docker .
</code></pre><h2 id="用基础映像启动一个容器并进行修改">用基础映像启动一个容器，并进行修改</h2>
<pre tabindex="0"><code>docker run -it -v ~/Downloads/:/usr/my/docker/download/ simlogin-with-docker /bin/bash
</code></pre><p>解释：使用 simlogin-with-docke 镜像启动一个 container。<code>-it</code>表示交互模式——启动容器后会进入 docker 的 shell。<code>-v ~/Downloads/:/path/in/container</code>表示将宿主机的<code>下载</code>目录挂载到容器的<code>/usr/my/docker/download/</code>。最后的<code>/bin/bash</code>是容器所执行的 CMD。注意我们在 Dockfile 中并没有定义 CMD，所以在这里需要加上<code>/bin/bash</code>。实际上不加<code>/bin/bash</code>好像也可以。</p>
<p>之后的终端是这样的</p>
<pre tabindex="0"><code>x1@carbon:~$ docker run -it -v ~/Downloads/:/usr/my/docker/download/ simlogin-with-docker /bin/bash
[root@4c97d816eba7 app]#
</code></pre><p>这样就进入了容器的 shell，像不像进入了一个虚拟机</p>
<p>这样就可以对这个“虚拟机”进行修改了：我做了以下：安装 java 和 nodejs、yum 安装相关库、pm2、设置 PATH、编写启动脚本<code>/app/run.sh</code></p>
<p>这些步骤只讲最后一步，因为前面的步骤和在虚拟机里操作一模一样，而编写 run.sh 则很关键也有一些坑。</p>
<h3 id="runsh">run.sh</h3>
<pre tabindex="0"><code>#! /bin/bash

. ~/.bashrc  #关键：导入PATH
pm2 start process.json --env local
tail -f /dev/null  # 关键：让此bash进程永远不退出
</code></pre><p>第一个坑：最好手动导入 PATH</p>
<p>第二个坑：CMD 执行的进程结束，容器进程就结束了。所以加上最后一句让 bash 进程永不退出。这点坑了我很久。。。</p>
<p>把这些做完之后，这个容器的就是我们需要的样子了。下一步就是将这个容器“持久化”成一个 image，这样以后就可以直接启动容器而不需要再做环境修改。</p>
<h2 id="持久化修改好的容器">持久化修改好的容器</h2>
<p>第一点！不要在容器的“交互性”shell 中输 exit 或者 ctrl+D！就是不要让这个容器的运行结束</p>
<p>第二步：另起终端。输入<code>docker ps</code>或<code>docker container list</code>，显示现在运行的容器，显示如下：</p>
<pre tabindex="0"><code>x1@carbon:~$ docker container list
CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS              PORTS               NAMES
4c97d816eba7        simlogin-with-docker   &#34;/bin/bash&#34;         22 minutes ago      Up 22 minutes       4000/tcp            distracted_agnesi
x1@carbon:~$ docker ps
CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS              PORTS               NAMES
4c97d816eba7        simlogin-with-docker   &#34;/bin/bash&#34;         22 minutes ago      Up 22 minutes       4000/tcp            distracted_agnesi
</code></pre><p>第三步：commit 容器，也就是“持久化”为镜像了</p>
<pre tabindex="0"><code>docker commit 4c97d816eba7 simlogin-with-docker:1.0
</code></pre><p>这样就新建了一个 simlogin-with-docker:1.0 映像。这就是最终的映像啦。</p>
<h2 id="运行这个完成体映像">运行这个完成体映像</h2>
<pre tabindex="0"><code>docker run  -d -p 80:4000 simlogin-with-docker /app/run.sh
</code></pre><p><code>-d</code>表示在后台运行；</p>
<p><code> -p 80:4000</code>表示宿主机 80 端口映射容器 4000 端口；</p>
<p><code>/app/run.sh</code>表示执行的 CMD，注意这个 sh 脚本被我们控制为了永远不会退出。</p>
<p>问题：这个 sh 脚本不会退出。。所以 pm2 启动的进程如果异常退出了，这个 docker 容器也不会退出，也就没有实现监控了。</p>
<h2 id="进入这个正在在运行的容器">进入这个正在在运行的容器</h2>
<p>一开始我用<code>docker attach containerID</code>，但是发现有一些问题。后来我用</p>
<pre tabindex="0"><code>docker exec -it containerID /bin/bash
</code></pre><p>好了，docker 算入门了吧</p>
<h2 id="删除容器镜像">删除容器、镜像</h2>
<p>一个镜像很容易就超级超级大，有必要删除没用的镜像和容器</p>
<p>要删除镜像，需要首先删除容器。</p>
<pre tabindex="0"><code># 删除所有容器
docker rm `docker ps -a -q`
# 删除所有镜像
docker rmi `docker images -a -q`
# 删除带关键字的镜像
docker rmi --force `docker images | grep xxx | awk &#39;{print $3}&#39;`
# 删除没有标签的镜像
docker rmi `docker images -q | awk &#39;/^&lt;none&gt;/ { print $3 }&#39;`
</code></pre><h1 id="push-本地镜像到-docker-hub">push 本地镜像到 docker hub</h1>
<p>首先<code>docker login</code>登录到 docker hub，需要输入 docker hub 的用户名密码</p>
<p>然后，把本地的 docker 镜像打上用户名的 tag..</p>
<p>最后 push</p>
<pre tabindex="0"><code>docker tag ubuntu:18.04 arloor/ubuntu:18.04
docker push arloor/ubuntu:18.04
docker search arloor
</code></pre><h1 id="centos-7-的-docker-使用">centos 7 的 docker 使用</h1>
<p>服务器一般是 centos 系统，记录一下 centos 中的一些东西</p>
<h2 id="安装-docker-ce">安装 docker-ce</h2>
<p>卸载旧版本</p>
<p>Docker 的早期版本称为 docker 或 docker-engine。如果安装了这些版本，请卸载它们及关联的依赖资源。</p>
<pre tabindex="0"><code> sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
</code></pre><p>安装相关依赖</p>
<pre tabindex="0"><code>yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
</code></pre><p>设置 docker 源</p>
<pre tabindex="0"><code>yum-config-manager \
  --add-repo \
  https://download.docker.com/linux/centos/docker-ce.repo
</code></pre><p>安装 docker</p>
<pre tabindex="0"><code>yum install docker-ce
</code></pre><h2 id="iptables">iptables</h2>
<p>iptables 是 linux 下的防火墙服务。在我的使用中，遇到一个问题：编辑/etc/sysconfig/iptables 配置文件后，重启 iptables 服务(service iptables restart)。正在运行的 docker 容器可以正常接受请求，却不能向其他服务器发送 http 请求（tcp 流量）。搜索之后发现，docker 服务启动时，会增加 iptables 规则，应该是定义 nat 规则的。当 iptables 服务重启时，docker 服务增加的 iptables 就被丢弃了，所以会出现这样的问题。</p>
<p>所以解决方式：</p>
<ol>
<li>重启 docker 服务 service docker restart</li>
<li>将 docker 增加的 iptables 持久化 iptables save（不怎么推荐且我也不知道有没有什么副作用）</li>
</ol>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/linux/turn-ubuntu-mine-own/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">把ubuntu18.04 变成我的ubuntu</span>
    </a>
    
    
    <a href="/posts/other/java-aes128/" class="navigation-next">
      <span class="navigation-tittle">java-AES128加密-代码与一些约定</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  


</article>


  </div>
<style>
  .content.container {
        width: 100%;
        max-width: none;
        height: calc(100vh - var(--sidebar-height, 49px));
        border: none;
        display: block;
        overflow-y: auto;
        box-sizing: border-box;
        margin-left: 0;
        margin-right: 0;
  }

  body:not(.type-iframe) .content.container {
        padding-left: max(1.5rem, calc((100% - var(--content-max-width, 38rem)) / 2));
        padding-right: max(1.5rem, calc((100% - var(--content-max-width, 38rem)) / 2));
  }
</style>
<script>
    (function () {
        var contentSelector = '.content.container';
        var rafId = 0;
        var resizeDebounceTimer = 0;
        var pendingHashScroll = false;

        function getHashTarget() {
            var hash = window.location.hash;
            var targetId = '';

            if (!hash || hash === '#') {
                return null;
            }

            targetId = hash.slice(1);
            try {
                targetId = decodeURIComponent(targetId);
            } catch (e) {
                
            }

            return document.getElementById(targetId);
        }

        function scrollToHashTarget() {
            var target = getHashTarget();
            if (!target) {
                return;
            }
            try {
                target.scrollIntoView({ block: 'start', inline: 'nearest' });
            } catch (e) {
                target.scrollIntoView(true);
            }
        }

        function applyPendingHashScroll() {
            if (!pendingHashScroll) {
                return;
            }
            pendingHashScroll = false;
            scrollToHashTarget();
        }

        function resizeContentHeight() {
            var content = document.querySelector(contentSelector);
            if (!content) {
                return;
            }
            var rect = content.getBoundingClientRect();
            var available = window.innerHeight - rect.top;
            if (available < 0) {
                available = 0;
            }
            content.style.height = available + 'px';
            applyPendingHashScroll();
        }

        function scheduleResize() {
            if (rafId) {
                return;
            }
            rafId = window.requestAnimationFrame(function () {
                rafId = 0;
                resizeContentHeight();
            });
        }

        function scheduleResizeDebounced(delay) {
            window.clearTimeout(resizeDebounceTimer);
            resizeDebounceTimer = window.setTimeout(scheduleResize, delay || 120);
        }

        function requestHashScroll() {
            if (!window.location.hash || window.location.hash === '#') {
                return;
            }
            pendingHashScroll = true;
            scheduleResize();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () {
                scheduleResize();
                requestHashScroll();
            }, { once: true });
        } else {
            scheduleResize();
            requestHashScroll();
        }

        window.addEventListener('load', function () {
            scheduleResize();
            requestHashScroll();
        });
        window.addEventListener('pageshow', function () {
            scheduleResize();
            requestHashScroll();
        });
        window.addEventListener('hashchange', requestHashScroll);
        window.addEventListener('resize', function () {
            scheduleResizeDebounced(120);
        });

        var menuToggle = document.getElementById('menuToggle');
        if (menuToggle) {
            menuToggle.addEventListener('change', function () {
                scheduleResize();
                window.setTimeout(scheduleResize, 250);
            });
        }
    })();
</script>
  
    



<script defer src="/js/all.js" crossorigin="anonymous"></script>

    
    
    <script src="/js/highlight.min.js"></script>
    <script src="/js/languages/dos.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.highlightAll();
    </script>
    

<style>
    .code-block-wrapper {
        position: relative;
    }
    .copy-code-button {
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 6px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s, background 0.3s;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .copy-code-button svg {
        width: 16px;
        height: 16px;
        fill: #fff;
        transition: fill 0.3s;
    }
    .code-block-wrapper:hover .copy-code-button {
        opacity: 1;
    }
    .copy-code-button:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    .copy-code-button.copied {
        background: rgba(46, 160, 67, 0.8);
        border-color: rgba(46, 160, 67, 1);
    }
    .copy-code-button.copied svg {
        fill: #fff;
    }
</style>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        
        document.querySelectorAll('pre code').forEach(function(codeBlock) {
            var pre = codeBlock.parentNode;
            
            
            if (pre.parentNode.classList.contains('code-block-wrapper')) {
                return;
            }
            
            
            var wrapper = document.createElement('div');
            wrapper.className = 'code-block-wrapper';
            pre.parentNode.insertBefore(wrapper, pre);
            wrapper.appendChild(pre);
            
            
            var button = document.createElement('button');
            button.className = 'copy-code-button';
            button.innerHTML = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';
            button.setAttribute('aria-label', '复制代码');
            button.setAttribute('title', '复制代码');
            
            var copyIcon = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';
            var checkIcon = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path></svg>';
            
            
            button.addEventListener('click', function() {
                var code = codeBlock.textContent;
                navigator.clipboard.writeText(code).then(function() {
                    button.innerHTML = checkIcon;
                    button.classList.add('copied');
                    button.setAttribute('aria-label', '已复制');
                    button.setAttribute('title', '已复制');
                    setTimeout(function() {
                        button.innerHTML = copyIcon;
                        button.classList.remove('copied');
                        button.setAttribute('aria-label', '复制代码');
                        button.setAttribute('title', '复制代码');
                    }, 2000);
                }).catch(function(err) {
                    console.error('复制失败:', err);
                });
            });
            
            wrapper.appendChild(button);
        });
    });
</script>




    



</body>

</html>
